version: '2'
services:
    web:
        build: 
            context: .
            dockerfile: Dockerfile.dev
        ports:
            - "3000"
        links:
            - redis
        restart: always
        environment:
            - ENV=dev
            - ADDR=https://a818fa35.ngrok.io/
        volumes:
            - ./lib:/usr/perception/lib
            - ./views:/usr/perception/views
            - ./test:/usr/perception/test
            - ./ip.tmp:/usr/perception/ip.tmp
            - ./public:/usr/perception/public
    redis:
        image: redis
        ports:
            - "6379"
    https-portal:
        image: steveltn/https-portal
        ports:
            - '80:80'
            - '443:443'
        links:
            - web
        environment:
            STAGE: 'local'
            WEBSOCKET: 'true'
            DOMAINS: '127.0.0.1 -> http://web:3000'